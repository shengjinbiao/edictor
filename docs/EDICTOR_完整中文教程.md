# EDICTOR 完整中文教程（安装到实战）

本文面向第一次上手 EDICTOR 的用户，覆盖安装、数据准备、界面说明、语义筛选、同源计算、对齐、导出与常见问题。

## 1. 仓库地址与安装方式

### 1.1 仓库地址

- 官方仓库：`https://github.com/digling/edictor`
- 你当前常用仓库（示例）：`https://github.com/shengjinbiao/edictor`

如果你在自己分支开发，建议先 fork 官方仓库，再从自己的仓库克隆。

### 1.2 安装方式 A：本地 Python 运行（推荐开发调试）

1. 克隆仓库

```bash
git clone https://github.com/digling/edictor.git
cd edictor
```

2. 建议创建虚拟环境

```bash
python -m venv .venv
# Windows PowerShell
.venv\Scripts\Activate.ps1
# macOS / Linux
source .venv/bin/activate
```

3. 安装

```bash
python -m pip install -e .
```

4. 启动服务

```bash
edictor server
```

默认访问：`http://localhost:9999`

### 1.3 安装方式 B：Docker 运行（推荐部署）

1. 克隆仓库

```bash
git clone https://github.com/digling/edictor.git
cd edictor
```

2. 构建镜像

```bash
docker build -t edictor .
```

3. 启动容器

```bash
docker run --rm -p 9999:9999 edictor
```

访问：`http://localhost:9999`

4. 使用 GPU（如有 CUDA 环境）

```bash
docker run --rm --gpus all -p 9999:9999 edictor
```

5. 修改端口（例如 9876）

```bash
docker run --rm -e PORT=9876 -p 9876:9876 edictor
```

说明：修改了前端或后端源码后，Docker 方式需要重新 `build` 才会生效。

---

## 2. 数据格式准备（非常重要）

建议你的表格至少包含以下列：

1. `ID`：行唯一编号  
2. `DOCULECT`：语言点/方言点  
3. `CONCEPT`：概念义项  
4. `FORM` 或 `IPA` 或 `TOKENS`：词形或分词结果

常见可选列：

1. `COGID`：整词同源编号  
2. `COGIDS`：部分同源编号  
3. `MORPHEMES`：语素切分  
4. 备注类列（自定义）

建议：

- 列名尽量规范，避免后续映射麻烦。  
- 空值统一为空字符串，不建议混用特殊占位符。  
- 如果同一概念跨语言点覆盖差异很大，先做覆盖率检查再跑计算。

---

## 3. 界面速览

顶部主菜单（中文界面常见）：

- 文件
- 视图
- 数据
- 工具
- 编辑
- 计算
- 工作流
- 特征向量分析
- 分析
- 关于

你会高频使用的区域：

1. 主词表表格（中间）  
2. 筛选条（doculect / concept / columns）  
3. 翻页按钮（previous / next）  
4. 状态栏（当前单元格、当前显示行、过滤状态）

---

## 4. 标准工作流（建议照这个顺序）

1. 导入词表（文件 -> 打开）  
2. 进行列检查与补列（例如 COGID/COGIDS）  
3. 过滤语言点与概念（先缩小范围）  
4. 分词（IPA2Tokens 或上传正字法）  
5. 同源集计算  
6. 对齐  
7. 对应模式  
8. 距离与谱系树  
9. 导出结果并人工复核

---

## 5. 文件菜单（导入、保存、配置）

### 5.1 打开与导出

- `打开...`：本地文件导入  
- `打开远程...`：远程地址导入  
- `下载`：导出当前数据  
- `本地保存`：通过本地 Python 服务保存

### 5.2 设置和模板

- `设置`：配置关键列映射与格式器  
- `自定义`：字段与行为定制  
- `模板`：复用常用字段结构

---

## 6. 数据菜单（排序、过滤、批量改值）

### 6.1 排序

- 按列升序/降序  
- 清除排序恢复原状态

### 6.2 快速过滤

- 选择列 + 输入值 -> 应用  
- 清除过滤恢复显示

### 6.3 批量赋值

在 `COLUMN = value` 输入框内按回车，可对整列赋值。  
适合初始化空列（如整列先写默认 COGID）。

---

## 7. 工具菜单（重点）

## 7.1 语义筛选（当前词表）

用途：对当前已加载词表的概念集合做语义筛选。

关键参数：

1. `Include`（包含词）：语义锚点词，建议多填同义词  
2. `Exclude`（排除词）：排除干扰语义  
3. `Threshold`：阈值，常从 `0.15~0.25` 试起  
4. `Require GPU`：有 CUDA 时可勾选

示例（筛“头”）：

- Include：`head; skull; cranium; forehead; 头; 头部`  
- Exclude：`leader; chief; first; suffix; 首领; 第一`

### 7.2 语义预筛（Excel/TSV）

用途：先处理外部文件，再生成筛选后 TSV，并可直接加载到 EDICTOR。

典型步骤：

1. 上传外部 Excel/TSV  
2. 指定 gloss 列（列名或列序号）  
3. 填 include/exclude  
4. 设置阈值、是否使用 GPU  
5. 运行并下载结果（或直接加载）

“预过滤字符（可选）”说明：

- 是前置粗筛，只让包含这些字符的行进入语义打分。  
- 优点：速度更快，噪音更低。  
- 风险：可能漏掉不含这些字符但语义相关的记录。  
- 不确定时可留空。

### 7.3 覆盖率检查

统计每个 `DOCULECT` 对概念集合的覆盖率。  
建议在计算前先看一次，避免某些语言点缺失太多影响结果。

### 7.4 正字法相关工具

- 生成正字法文件  
- 上传正字法并分词

适合非 IPA 原始文本数据的统一切分。

---

## 8. 编辑菜单（人工修订）

常见操作：

1. 复制/粘贴单元格  
2. 清空剪贴板  
3. 显示/隐藏各分析面板  
4. 直接点击单元格编辑

建议：

- 自动计算后务必人工抽样复核。  
- 修改关键列（如 COGID）后可重新跑下游模块。

---

## 9. 计算菜单（核心算法）

### 9.1 IPA2Tokens 分词

将 IPA 文本切为 token 序列，作为后续计算基础。

### 9.2 同源集计算

自动生成或更新 `COGID`，用于同源集合分析。

### 9.3 对齐

对同源词内词形进行对齐，便于音对应观察。

### 9.4 对应模式

从对齐结果中提取跨语言的对应关系模式。

### 9.5 距离与谱系树

计算语言距离并输出树结构（可用于后续可视化）。

---

## 10. 工作流与特征向量分析

### 10.1 工作流

将多步骤串起来执行，适合批处理与标准流程复用。

### 10.2 特征向量分析

提供分词、向量化、对齐、相似度、距离、音变链等流程。  
适合做对照实验或高级分析。

---

## 11. 分析菜单（结果解释）

常见面板：

1. 语音  
2. 共词化  
3. 对应关系  
4. 同源词  
5. 音变链

建议配合人工语言学判断使用，不建议仅凭自动结果下结论。

---

## 12. 常见问题（FAQ）

### Q1：修改了代码但页面没变化？

如果你用 Docker 运行，需要重新构建镜像：

```bash
docker build -t edictor .
docker run --rm -p 9999:9999 edictor
```

### Q2：GPU 没生效？

1. 容器启动需带 `--gpus all`  
2. 语义筛选里勾选 `Require GPU`  
3. 宿主机需正确安装 NVIDIA 驱动与 Docker GPU 支持

### Q3：语义筛选填“词语”还是“定义句子”？

都可以，但建议优先填“语义锚点词/短语”，并给同义词集合。  
不用要求和表里原句完全一致，模型按语义相似度计算。

### Q4：翻页和概念切换容易混淆？

- 多概念场景优先用 `previous/next` 或 `PgUp/PgDn` 翻页。  
- 概念箭头用于单概念连续切换更直观。

---

## 13. 一条最短上手路径（5 分钟）

1. 启动服务（本地或 Docker）  
2. 打开词表  
3. 运行分词  
4. 运行同源集 + 对齐  
5. 导出结果

---

## 14. 建议的项目文档组织

建议在仓库中保留以下文档：

1. `README.md`：快速开始（安装+最短路径）  
2. `docs/EDICTOR_完整中文教程.md`：完整教程（本文件）  
3. `README_semantic.md`：语义筛选专项说明

